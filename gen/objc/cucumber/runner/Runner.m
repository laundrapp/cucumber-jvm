//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Users/Salton/Documents/Projects/cucumber-jvm/core/src/main/java/cucumber/runner/Runner.java
//

#include "IOSClass.h"
#include "IOSObjectArray.h"
#include "J2ObjC_source.h"
#include "cucumber/api/HookType.h"
#include "cucumber/api/SnippetType.h"
#include "cucumber/api/StepDefinitionReporter.h"
#include "cucumber/api/TestCase.h"
#include "cucumber/api/TestStep.h"
#include "cucumber/api/event/SnippetsSuggestedEvent.h"
#include "cucumber/runner/EventBus.h"
#include "cucumber/runner/PickleTestStep.h"
#include "cucumber/runner/Runner.h"
#include "cucumber/runner/UndefinedStepException.h"
#include "cucumber/runner/UnskipableStep.h"
#include "cucumber/runtime/AmbiguousStepDefinitionsException.h"
#include "cucumber/runtime/AmbiguousStepDefinitionsMatch.h"
#include "cucumber/runtime/Backend.h"
#include "cucumber/runtime/FailedStepInstantiationMatch.h"
#include "cucumber/runtime/Glue.h"
#include "cucumber/runtime/HookDefinition.h"
#include "cucumber/runtime/HookDefinitionMatch.h"
#include "cucumber/runtime/RuntimeOptions.h"
#include "cucumber/runtime/StepDefinitionMatch.h"
#include "cucumber/runtime/UndefinedStepDefinitionMatch.h"
#include "cucumber/runtime/snippets/FunctionNameGenerator.h"
#include "gherkin/events/PickleEvent.h"
#include "gherkin/pickles/Pickle.h"
#include "gherkin/pickles/PickleStep.h"
#include "gherkin/pickles/PickleString.h"
#include "gherkin/pickles/PickleTable.h"
#include "java/lang/Long.h"
#include "java/lang/StackTraceElement.h"
#include "java/lang/System.h"
#include "java/lang/Throwable.h"
#include "java/util/ArrayList.h"
#include "java/util/Collection.h"
#include "java/util/Collections.h"
#include "java/util/List.h"

@interface CCBRunner () {
 @public
  id<CCBRGlue> glue_;
  CCBEventBus *bus_;
  id<JavaUtilCollection> backends_;
  CCBRRuntimeOptions *runtimeOptions_;
}

- (CucumberApiTestCase *)createTestCaseForPickleWithGHKPickleEvent:(GHKPickleEvent *)pickleEvent;

- (void)addTestStepsForPickleStepsWithJavaUtilList:(id<JavaUtilList>)testSteps
                                withGHKPickleEvent:(GHKPickleEvent *)pickleEvent;

- (void)addTestStepsForBeforeHooksWithJavaUtilList:(id<JavaUtilList>)testSteps
                                  withJavaUtilList:(id<JavaUtilList>)tags;

- (void)addTestStepsForAfterHooksWithJavaUtilList:(id<JavaUtilList>)testSteps
                                 withJavaUtilList:(id<JavaUtilList>)tags;

- (void)addTestStepsForHooksWithJavaUtilList:(id<JavaUtilList>)testSteps
                            withJavaUtilList:(id<JavaUtilList>)tags
                            withJavaUtilList:(id<JavaUtilList>)hooks
                     withCucumberApiHookType:(CucumberApiHookType *)hookType;

- (void)buildBackendWorlds;

- (void)disposeBackendWorlds;

@end

J2OBJC_FIELD_SETTER(CCBRunner, glue_, id<CCBRGlue>)
J2OBJC_FIELD_SETTER(CCBRunner, bus_, CCBEventBus *)
J2OBJC_FIELD_SETTER(CCBRunner, backends_, id<JavaUtilCollection>)
J2OBJC_FIELD_SETTER(CCBRunner, runtimeOptions_, CCBRRuntimeOptions *)

__attribute__((unused)) static CucumberApiTestCase *CCBRunner_createTestCaseForPickleWithGHKPickleEvent_(CCBRunner *self, GHKPickleEvent *pickleEvent);

__attribute__((unused)) static void CCBRunner_addTestStepsForPickleStepsWithJavaUtilList_withGHKPickleEvent_(CCBRunner *self, id<JavaUtilList> testSteps, GHKPickleEvent *pickleEvent);

__attribute__((unused)) static void CCBRunner_addTestStepsForBeforeHooksWithJavaUtilList_withJavaUtilList_(CCBRunner *self, id<JavaUtilList> testSteps, id<JavaUtilList> tags);

__attribute__((unused)) static void CCBRunner_addTestStepsForAfterHooksWithJavaUtilList_withJavaUtilList_(CCBRunner *self, id<JavaUtilList> testSteps, id<JavaUtilList> tags);

__attribute__((unused)) static void CCBRunner_addTestStepsForHooksWithJavaUtilList_withJavaUtilList_withJavaUtilList_withCucumberApiHookType_(CCBRunner *self, id<JavaUtilList> testSteps, id<JavaUtilList> tags, id<JavaUtilList> hooks, CucumberApiHookType *hookType);

__attribute__((unused)) static void CCBRunner_buildBackendWorlds(CCBRunner *self);

__attribute__((unused)) static void CCBRunner_disposeBackendWorlds(CCBRunner *self);

@implementation CCBRunner

- (instancetype __nonnull)initWithCCBRGlue:(id<CCBRGlue>)glue
                           withCCBEventBus:(CCBEventBus *)bus
                    withJavaUtilCollection:(id<JavaUtilCollection>)backends
                    withCCBRRuntimeOptions:(CCBRRuntimeOptions *)runtimeOptions {
  CCBRunner_initWithCCBRGlue_withCCBEventBus_withJavaUtilCollection_withCCBRRuntimeOptions_(self, glue, bus, backends, runtimeOptions);
  return self;
}

- (void)runUnreportedStepWithNSString:(NSString *)featurePath
                         withNSString:(NSString *)language
                         withNSString:(NSString *)stepName
                              withInt:(jint)line
                     withJavaUtilList:(id<JavaUtilList>)dataTableRows
                  withGHKPickleString:(GHKPickleString *)docString {
  id<JavaUtilList> arguments = create_JavaUtilArrayList_init();
  if (dataTableRows != nil && ![dataTableRows isEmpty]) {
    [arguments addWithId:create_GHKPickleTable_initWithJavaUtilList_(dataTableRows)];
  }
  else if (docString != nil) {
    [arguments addWithId:docString];
  }
  GHKPickleStep *step = create_GHKPickleStep_initWithNSString_withJavaUtilList_withJavaUtilList_(stepName, arguments, JavaUtilCollections_emptyList());
  CCBRStepDefinitionMatch *match = [((id<CCBRGlue>) nil_chk(glue_)) stepDefinitionMatchWithNSString:featurePath withGHKPickleStep:step];
  if (match == nil) {
    CCBUndefinedStepException *error = create_CCBUndefinedStepException_initWithGHKPickleStep_(step);
    IOSObjectArray *originalTrace = [error getStackTrace];
    IOSObjectArray *newTrace = [IOSObjectArray arrayWithLength:((IOSObjectArray *) nil_chk(originalTrace))->size_ + 1 type:JavaLangStackTraceElement_class_()];
    IOSObjectArray_SetAndConsume(newTrace, 0, new_JavaLangStackTraceElement_initWithNSString_withNSString_withNSString_withInt_(@"\u273d", @"StepDefinition", featurePath, line));
    JavaLangSystem_arraycopyWithId_withInt_withId_withInt_withInt_(originalTrace, 0, newTrace, 1, originalTrace->size_);
    [error setStackTraceWithJavaLangStackTraceElementArray:newTrace];
    @throw error;
  }
  [match runStepWithNSString:language withCucumberApiScenario:nil];
}

- (void)runPickleWithGHKPickleEvent:(GHKPickleEvent *)pickle {
  CCBRunner_buildBackendWorlds(self);
  CucumberApiTestCase *testCase = CCBRunner_createTestCaseForPickleWithGHKPickleEvent_(self, pickle);
  [((CucumberApiTestCase *) nil_chk(testCase)) runWithCCBEventBus:bus_];
  CCBRunner_disposeBackendWorlds(self);
}

- (id<CCBRGlue>)getGlue {
  return glue_;
}

- (void)reportStepDefinitionsWithCucumberApiStepDefinitionReporter:(id<CucumberApiStepDefinitionReporter>)stepDefinitionReporter {
  [((id<CCBRGlue>) nil_chk(glue_)) reportStepDefinitionsWithCucumberApiStepDefinitionReporter:stepDefinitionReporter];
}

- (CucumberApiTestCase *)createTestCaseForPickleWithGHKPickleEvent:(GHKPickleEvent *)pickleEvent {
  return CCBRunner_createTestCaseForPickleWithGHKPickleEvent_(self, pickleEvent);
}

- (void)addTestStepsForPickleStepsWithJavaUtilList:(id<JavaUtilList>)testSteps
                                withGHKPickleEvent:(GHKPickleEvent *)pickleEvent {
  CCBRunner_addTestStepsForPickleStepsWithJavaUtilList_withGHKPickleEvent_(self, testSteps, pickleEvent);
}

- (void)addTestStepsForBeforeHooksWithJavaUtilList:(id<JavaUtilList>)testSteps
                                  withJavaUtilList:(id<JavaUtilList>)tags {
  CCBRunner_addTestStepsForBeforeHooksWithJavaUtilList_withJavaUtilList_(self, testSteps, tags);
}

- (void)addTestStepsForAfterHooksWithJavaUtilList:(id<JavaUtilList>)testSteps
                                 withJavaUtilList:(id<JavaUtilList>)tags {
  CCBRunner_addTestStepsForAfterHooksWithJavaUtilList_withJavaUtilList_(self, testSteps, tags);
}

- (void)addTestStepsForHooksWithJavaUtilList:(id<JavaUtilList>)testSteps
                            withJavaUtilList:(id<JavaUtilList>)tags
                            withJavaUtilList:(id<JavaUtilList>)hooks
                     withCucumberApiHookType:(CucumberApiHookType *)hookType {
  CCBRunner_addTestStepsForHooksWithJavaUtilList_withJavaUtilList_withJavaUtilList_withCucumberApiHookType_(self, testSteps, tags, hooks, hookType);
}

- (void)buildBackendWorlds {
  CCBRunner_buildBackendWorlds(self);
}

- (void)disposeBackendWorlds {
  CCBRunner_disposeBackendWorlds(self);
}

- (void)dealloc {
  RELEASE_(glue_);
  RELEASE_(bus_);
  RELEASE_(backends_);
  RELEASE_(runtimeOptions_);
  [super dealloc];
}

+ (const J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { NULL, NULL, 0x1, -1, 0, -1, 1, -1, -1 },
    { NULL, "V", 0x1, 2, 3, 4, 5, -1, -1 },
    { NULL, "V", 0x1, 6, 7, -1, -1, -1, -1 },
    { NULL, "LCCBRGlue;", 0x1, -1, -1, -1, -1, -1, -1 },
    { NULL, "V", 0x1, 8, 9, -1, -1, -1, -1 },
    { NULL, "LCucumberApiTestCase;", 0x2, 10, 7, -1, -1, -1, -1 },
    { NULL, "V", 0x2, 11, 12, -1, 13, -1, -1 },
    { NULL, "V", 0x2, 14, 15, -1, 16, -1, -1 },
    { NULL, "V", 0x2, 17, 15, -1, 16, -1, -1 },
    { NULL, "V", 0x2, 18, 19, -1, 20, -1, -1 },
    { NULL, "V", 0x2, -1, -1, -1, -1, -1, -1 },
    { NULL, "V", 0x2, -1, -1, -1, -1, -1, -1 },
  };
  #pragma clang diagnostic push
  #pragma clang diagnostic ignored "-Wobjc-multiple-method-names"
  #pragma clang diagnostic ignored "-Wundeclared-selector"
  methods[0].selector = @selector(initWithCCBRGlue:withCCBEventBus:withJavaUtilCollection:withCCBRRuntimeOptions:);
  methods[1].selector = @selector(runUnreportedStepWithNSString:withNSString:withNSString:withInt:withJavaUtilList:withGHKPickleString:);
  methods[2].selector = @selector(runPickleWithGHKPickleEvent:);
  methods[3].selector = @selector(getGlue);
  methods[4].selector = @selector(reportStepDefinitionsWithCucumberApiStepDefinitionReporter:);
  methods[5].selector = @selector(createTestCaseForPickleWithGHKPickleEvent:);
  methods[6].selector = @selector(addTestStepsForPickleStepsWithJavaUtilList:withGHKPickleEvent:);
  methods[7].selector = @selector(addTestStepsForBeforeHooksWithJavaUtilList:withJavaUtilList:);
  methods[8].selector = @selector(addTestStepsForAfterHooksWithJavaUtilList:withJavaUtilList:);
  methods[9].selector = @selector(addTestStepsForHooksWithJavaUtilList:withJavaUtilList:withJavaUtilList:withCucumberApiHookType:);
  methods[10].selector = @selector(buildBackendWorlds);
  methods[11].selector = @selector(disposeBackendWorlds);
  #pragma clang diagnostic pop
  static const J2ObjcFieldInfo fields[] = {
    { "glue_", "LCCBRGlue;", .constantValue.asLong = 0, 0x12, -1, -1, -1, -1 },
    { "bus_", "LCCBEventBus;", .constantValue.asLong = 0, 0x12, -1, -1, -1, -1 },
    { "backends_", "LJavaUtilCollection;", .constantValue.asLong = 0, 0x12, -1, -1, 21, -1 },
    { "runtimeOptions_", "LCCBRRuntimeOptions;", .constantValue.asLong = 0, 0x12, -1, -1, -1, -1 },
  };
  static const void *ptrTable[] = { "LCCBRGlue;LCCBEventBus;LJavaUtilCollection;LCCBRRuntimeOptions;", "(Lcucumber/runtime/Glue;Lcucumber/runner/EventBus;Ljava/util/Collection<+Lcucumber/runtime/Backend;>;Lcucumber/runtime/RuntimeOptions;)V", "runUnreportedStep", "LNSString;LNSString;LNSString;ILJavaUtilList;LGHKPickleString;", "LJavaLangThrowable;", "(Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;ILjava/util/List<Lgherkin/pickles/PickleRow;>;Lgherkin/pickles/PickleString;)V", "runPickle", "LGHKPickleEvent;", "reportStepDefinitions", "LCucumberApiStepDefinitionReporter;", "createTestCaseForPickle", "addTestStepsForPickleSteps", "LJavaUtilList;LGHKPickleEvent;", "(Ljava/util/List<Lcucumber/api/TestStep;>;Lgherkin/events/PickleEvent;)V", "addTestStepsForBeforeHooks", "LJavaUtilList;LJavaUtilList;", "(Ljava/util/List<Lcucumber/api/TestStep;>;Ljava/util/List<Lgherkin/pickles/PickleTag;>;)V", "addTestStepsForAfterHooks", "addTestStepsForHooks", "LJavaUtilList;LJavaUtilList;LJavaUtilList;LCucumberApiHookType;", "(Ljava/util/List<Lcucumber/api/TestStep;>;Ljava/util/List<Lgherkin/pickles/PickleTag;>;Ljava/util/List<Lcucumber/runtime/HookDefinition;>;Lcucumber/api/HookType;)V", "Ljava/util/Collection<+Lcucumber/runtime/Backend;>;" };
  static const J2ObjcClassInfo _CCBRunner = { "Runner", "cucumber.runner", ptrTable, methods, fields, 7, 0x1, 12, 4, -1, -1, -1, -1, -1 };
  return &_CCBRunner;
}

@end

void CCBRunner_initWithCCBRGlue_withCCBEventBus_withJavaUtilCollection_withCCBRRuntimeOptions_(CCBRunner *self, id<CCBRGlue> glue, CCBEventBus *bus, id<JavaUtilCollection> backends, CCBRRuntimeOptions *runtimeOptions) {
  NSObject_init(self);
  JreStrongAssign(&self->glue_, glue);
  JreStrongAssign(&self->bus_, bus);
  JreStrongAssign(&self->runtimeOptions_, runtimeOptions);
  JreStrongAssign(&self->backends_, backends);
  for (id<CCBRBackend> __strong backend in nil_chk(backends)) {
    [((id<CCBRBackend>) nil_chk(backend)) loadGlueWithCCBRGlue:glue withJavaUtilList:[((CCBRRuntimeOptions *) nil_chk(runtimeOptions)) getGlue]];
    [backend setUnreportedStepExecutorWithCCBRUnreportedStepExecutor:self];
  }
}

CCBRunner *new_CCBRunner_initWithCCBRGlue_withCCBEventBus_withJavaUtilCollection_withCCBRRuntimeOptions_(id<CCBRGlue> glue, CCBEventBus *bus, id<JavaUtilCollection> backends, CCBRRuntimeOptions *runtimeOptions) {
  J2OBJC_NEW_IMPL(CCBRunner, initWithCCBRGlue_withCCBEventBus_withJavaUtilCollection_withCCBRRuntimeOptions_, glue, bus, backends, runtimeOptions)
}

CCBRunner *create_CCBRunner_initWithCCBRGlue_withCCBEventBus_withJavaUtilCollection_withCCBRRuntimeOptions_(id<CCBRGlue> glue, CCBEventBus *bus, id<JavaUtilCollection> backends, CCBRRuntimeOptions *runtimeOptions) {
  J2OBJC_CREATE_IMPL(CCBRunner, initWithCCBRGlue_withCCBEventBus_withJavaUtilCollection_withCCBRRuntimeOptions_, glue, bus, backends, runtimeOptions)
}

CucumberApiTestCase *CCBRunner_createTestCaseForPickleWithGHKPickleEvent_(CCBRunner *self, GHKPickleEvent *pickleEvent) {
  id<JavaUtilList> testSteps = create_JavaUtilArrayList_init();
  if (![((id<JavaUtilList>) nil_chk([((GHKPickle *) nil_chk(((GHKPickleEvent *) nil_chk(pickleEvent))->pickle_)) getSteps])) isEmpty]) {
    if (![((CCBRRuntimeOptions *) nil_chk(self->runtimeOptions_)) isDryRun]) {
      CCBRunner_addTestStepsForBeforeHooksWithJavaUtilList_withJavaUtilList_(self, testSteps, [pickleEvent->pickle_ getTags]);
    }
    CCBRunner_addTestStepsForPickleStepsWithJavaUtilList_withGHKPickleEvent_(self, testSteps, pickleEvent);
    if (![self->runtimeOptions_ isDryRun]) {
      CCBRunner_addTestStepsForAfterHooksWithJavaUtilList_withJavaUtilList_(self, testSteps, [pickleEvent->pickle_ getTags]);
    }
  }
  return create_CucumberApiTestCase_initWithJavaUtilList_withGHKPickleEvent_withBoolean_(testSteps, pickleEvent, [((CCBRRuntimeOptions *) nil_chk(self->runtimeOptions_)) isDryRun]);
}

void CCBRunner_addTestStepsForPickleStepsWithJavaUtilList_withGHKPickleEvent_(CCBRunner *self, id<JavaUtilList> testSteps, GHKPickleEvent *pickleEvent) {
  for (GHKPickleStep * __strong step in nil_chk([((GHKPickle *) nil_chk(((GHKPickleEvent *) nil_chk(pickleEvent))->pickle_)) getSteps])) {
    CCBRStepDefinitionMatch *match;
    @try {
      match = [((id<CCBRGlue>) nil_chk(self->glue_)) stepDefinitionMatchWithNSString:pickleEvent->uri_ withGHKPickleStep:step];
      if (match == nil) {
        id<JavaUtilList> snippets = create_JavaUtilArrayList_init();
        for (id<CCBRBackend> __strong backend in nil_chk(self->backends_)) {
          NSString *snippet = [((id<CCBRBackend>) nil_chk(backend)) getSnippetWithGHKPickleStep:step withNSString:@"**KEYWORD**" withCCBRFunctionNameGenerator:[((CucumberApiSnippetType *) nil_chk([((CCBRRuntimeOptions *) nil_chk(self->runtimeOptions_)) getSnippetType])) getFunctionNameGenerator]];
          if (snippet != nil) {
            [snippets addWithId:snippet];
          }
        }
        if (![snippets isEmpty]) {
          [((CCBEventBus *) nil_chk(self->bus_)) sendWithCucumberApiEventEvent:create_CucumberApiEventSnippetsSuggestedEvent_initWithJavaLangLong_withNSString_withJavaUtilList_withJavaUtilList_([self->bus_ getTime], pickleEvent->uri_, [((GHKPickleStep *) nil_chk(step)) getLocations], snippets)];
        }
        match = create_CCBRUndefinedStepDefinitionMatch_initWithGHKPickleStep_(step);
      }
    }
    @catch (CCBRAmbiguousStepDefinitionsException *e) {
      match = create_CCBRAmbiguousStepDefinitionsMatch_initWithNSString_withGHKPickleStep_withCCBRAmbiguousStepDefinitionsException_(pickleEvent->uri_, step, e);
    }
    @catch (JavaLangThrowable *t) {
      match = create_CCBRFailedStepInstantiationMatch_initWithNSString_withGHKPickleStep_withJavaLangThrowable_(pickleEvent->uri_, step, t);
    }
    [((id<JavaUtilList>) nil_chk(testSteps)) addWithId:create_CCBPickleTestStep_initWithNSString_withGHKPickleStep_withCCBRDefinitionMatch_(pickleEvent->uri_, step, match)];
  }
}

void CCBRunner_addTestStepsForBeforeHooksWithJavaUtilList_withJavaUtilList_(CCBRunner *self, id<JavaUtilList> testSteps, id<JavaUtilList> tags) {
  CCBRunner_addTestStepsForHooksWithJavaUtilList_withJavaUtilList_withJavaUtilList_withCucumberApiHookType_(self, testSteps, tags, [((id<CCBRGlue>) nil_chk(self->glue_)) getBeforeHooks], JreLoadEnum(CucumberApiHookType, Before));
}

void CCBRunner_addTestStepsForAfterHooksWithJavaUtilList_withJavaUtilList_(CCBRunner *self, id<JavaUtilList> testSteps, id<JavaUtilList> tags) {
  CCBRunner_addTestStepsForHooksWithJavaUtilList_withJavaUtilList_withJavaUtilList_withCucumberApiHookType_(self, testSteps, tags, [((id<CCBRGlue>) nil_chk(self->glue_)) getAfterHooks], JreLoadEnum(CucumberApiHookType, After));
}

void CCBRunner_addTestStepsForHooksWithJavaUtilList_withJavaUtilList_withJavaUtilList_withCucumberApiHookType_(CCBRunner *self, id<JavaUtilList> testSteps, id<JavaUtilList> tags, id<JavaUtilList> hooks, CucumberApiHookType *hookType) {
  for (id<CCBRHookDefinition> __strong hook in nil_chk(hooks)) {
    if ([((id<CCBRHookDefinition>) nil_chk(hook)) matchesWithJavaUtilCollection:tags]) {
      CucumberApiTestStep *testStep = create_CCBUnskipableStep_initWithCucumberApiHookType_withCCBRDefinitionMatch_(hookType, create_CCBRHookDefinitionMatch_initWithCCBRHookDefinition_(hook));
      [((id<JavaUtilList>) nil_chk(testSteps)) addWithId:testStep];
    }
  }
}

void CCBRunner_buildBackendWorlds(CCBRunner *self) {
  [((CCBRRuntimeOptions *) nil_chk(self->runtimeOptions_)) getPlugins];
  for (id<CCBRBackend> __strong backend in nil_chk(self->backends_)) {
    [((id<CCBRBackend>) nil_chk(backend)) buildWorld];
  }
}

void CCBRunner_disposeBackendWorlds(CCBRunner *self) {
  for (id<CCBRBackend> __strong backend in nil_chk(self->backends_)) {
    [((id<CCBRBackend>) nil_chk(backend)) disposeWorld];
  }
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(CCBRunner)
